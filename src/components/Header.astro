---
import { siteConfig } from "../config";

const hasProjects = siteConfig.projects && siteConfig.projects.length > 0;
const hasExperience = siteConfig.experience && siteConfig.experience.length > 0;
const hasEducation = siteConfig.education && siteConfig.education.length > 0;
---

<header
  id="header"
  class="fixed top-6 left-1/2 -translate-x-1/2 z-50 transition-all duration-500 ease-out"
>
  <nav
    id="nav-pill"
    class="px-6 py-3 rounded-full backdrop-blur-md border border-[var(--theme-border)] bg-[var(--theme-bg)]/60 shadow-sm flex items-center gap-6 md:gap-8 transition-all duration-300"
  >
    <ul
      class="flex items-center gap-4 md:gap-6 text-xs md:text-sm font-light uppercase tracking-widest"
    >
      <li>
        <a
          href="#about"
          data-nav="about"
          class="nav-link text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200 flex items-center"
        >
          <span class="nav-indicator hidden"></span>
          about
        </a>
      </li>
      {
        hasProjects && (
          <li>
            <a
              href="#projects"
              data-nav="projects"
              class="nav-link text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200 flex items-center"
            >
              <span class="nav-indicator hidden" />
              projects
            </a>
          </li>
        )
      }
      {
        hasExperience && (
          <li>
            <a
              href="#experience"
              data-nav="experience"
              class="nav-link text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200 flex items-center"
            >
              <span class="nav-indicator hidden" />
              experience
            </a>
          </li>
        )
      }
      {
        hasEducation && (
          <li>
            <a
              href="#education"
              data-nav="education"
              class="nav-link text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200 flex items-center"
            >
              <span class="nav-indicator hidden" />
              education
            </a>
          </li>
        )
      }
    </ul>

    <div
      class="w-px h-4 bg-[var(--theme-border)] hidden md:block transition-colors duration-300 nav-border"
    >
    </div>

    <div class="flex items-center gap-3">
      {
        siteConfig.social?.email && (
          <a
            href={`mailto:${siteConfig.social.email}`}
            aria-label="Email"
            class="nav-social text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="w-4 h-4"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" />
              <path d="M3 7l9 6l9 -6" />
            </svg>
          </a>
        )
      }
      {
        siteConfig.social?.linkedin && (
          <a
            href={siteConfig.social.linkedin}
            target="_blank"
            rel="noopener noreferrer"
            aria-label="LinkedIn"
            class="nav-social text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="w-4 h-4"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M8 11v5" />
              <path d="M8 8v.01" />
              <path d="M12 16v-5" />
              <path d="M16 16v-3a2 2 0 1 0 -4 0" />
              <path d="M3 7a4 4 0 0 1 4 -4h10a4 4 0 0 1 4 4v10a4 4 0 0 1 -4 4h-10a4 4 0 0 1 -4 -4z" />
            </svg>
          </a>
        )
      }
      {
        siteConfig.social?.github && (
          <a
            href={siteConfig.social.github}
            target="_blank"
            rel="noopener noreferrer"
            aria-label="GitHub"
            class="nav-social text-[var(--theme-text-secondary)] hover:text-[var(--theme-accent)] transition-colors duration-200"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              width="18"
              height="18"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
              stroke-linecap="round"
              stroke-linejoin="round"
              class="w-4 h-4"
            >
              <path stroke="none" d="M0 0h24v24H0z" fill="none" />
              <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
            </svg>
          </a>
        )
      }
    </div>
  </nav>

  <!-- Scroll progress bar -->
  <div
    id="scroll-progress"
    class="absolute bottom-0 left-0 h-[2px] bg-[var(--theme-accent)] transition-all duration-150 ease-out"
    style="width: 0%"
  >
  </div>
</header>

<style>
  .nav-indicator {
    display: inline-block !important;
    width: 6px;
    height: 6px;
    background-color: var(--color-deep-teal);
    transform: rotate(45deg);
    margin-right: 6px;
  }

  body.dark .nav-indicator {
    background-color: var(--color-dark-teal);
  }

  /* Scrolled state for nav pill */
  #nav-pill.scrolled {
    background: rgba(248, 246, 243, 0.85);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
    backdrop-filter: blur(12px);
  }

  body.dark #nav-pill.scrolled {
    background: rgba(13, 17, 23, 0.85);
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  }
</style>

<script>
  // Subtle scroll-based animation (no hiding)
  let ticking = false;

  window.addEventListener("scroll", () => {
    if (!ticking) {
      window.requestAnimationFrame(() => {
        const scrollY = window.scrollY;
        const navPill = document.getElementById("nav-pill");
        const scrollProgress = document.getElementById("scroll-progress");
        const navBorders = document.querySelectorAll(".nav-border");
        const navLinks = document.querySelectorAll(".nav-link");
        const navSocials = document.querySelectorAll(".nav-social");

        // Calculate scroll intensity (0 to 1)
        const scrollIntensity = Math.min(scrollY / 300, 1);

        // Apply subtle transformations based on scroll
        if (navPill) {
          // Scale down slightly and increase opacity on scroll
          const scale = 1 - scrollIntensity * 0.02; // 1 to 0.98
          const bgOpacity = 0.6 + scrollIntensity * 0.25; // 0.6 to 0.85

          navPill.style.transform = `scale(${scale})`;

          // Add scrolled class for additional styling
          if (scrollY > 50) {
            navPill.classList.add("scrolled");
            // Update dark mode specific background
            if (document.body.classList.contains("dark")) {
              navPill.style.background = `rgba(13, 17, 23, ${bgOpacity})`;
            } else {
              navPill.style.background = `rgba(248, 246, 243, ${bgOpacity})`;
            }
          } else {
            navPill.classList.remove("scrolled");
            if (document.body.classList.contains("dark")) {
              navPill.style.background = `rgba(13, 17, 23, 0.6)`;
            } else {
              navPill.style.background = `rgba(248, 246, 243, 0.6)`;
            }
          }
        }

        // Scroll progress
        const docHeight =
          document.documentElement.scrollHeight - window.innerHeight;
        const progress = (scrollY / docHeight) * 100;
        if (scrollProgress) {
          scrollProgress.style.width = `${Math.min(progress, 100)}%`;
        }

        ticking = false;
      });
      ticking = true;
    }
  });

  // Update colors when theme changes
  const updateNavColors = () => {
    const isDark = document.body.classList.contains("dark");
    const navPill = document.getElementById("nav-pill");
    const scrollY = window.scrollY;

    if (navPill) {
      const bgOpacity = scrollY > 50 ? 0.85 : 0.6;
      if (isDark) {
        navPill.style.background = `rgba(13, 17, 23, ${bgOpacity})`;
        navPill.style.borderColor = "var(--color-dark-border)";
      } else {
        navPill.style.background = `rgba(248, 246, 243, ${bgOpacity})`;
        navPill.style.borderColor = "var(--color-warm-border)";
      }
    }
  };

  // Listen for theme changes
  const observer = new MutationObserver(updateNavColors);
  observer.observe(document.body, {
    attributes: true,
    attributeFilter: ["class"],
  });

  // Active section highlighting
  const sections = ["about", "projects", "experience", "education"];
  const navLinks = document.querySelectorAll("[data-nav]");

  const observerOptions = {
    root: null,
    rootMargin: "-50% 0px -50% 0px",
    threshold: 0,
  };

  const sectionObserver = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        const id = entry.target.id;
        navLinks.forEach((link) => {
          const indicator = link.querySelector(".nav-indicator");
          if (link.getAttribute("data-nav") === id) {
            indicator?.classList.remove("hidden");
            link.classList.add("text-[var(--theme-accent)]");
            link.classList.remove("text-[var(--theme-text-secondary)]");
          } else {
            indicator?.classList.add("hidden");
            link.classList.remove("text-[var(--color-deep-teal)]");
            link.classList.add("text-[var(--color-warm-text-secondary)]");
          }
        });
      }
    });
  }, observerOptions);

  sections.forEach((section) => {
    const element = document.getElementById(section);
    if (element) sectionObserver.observe(element);
  });
</script>

---
import Header from "../components/Header.astro";
import Hero from "../components/Hero.astro";
import About from "../components/About.astro";
import Projects from "../components/Projects.astro";
import Experience from "../components/Experience.astro";
import Education from "../components/Education.astro";
import Footer from "../components/Footer.astro";
import { siteConfig } from "../config";
import "../styles/global.css";
// Supports weights 100-700
import "@fontsource/ibm-plex-mono/400.css";
import "@fontsource/ibm-plex-mono/400-italic.css";
import "@fontsource/ibm-plex-mono/500.css";
import "@fontsource/ibm-plex-mono/500-italic.css";
import "@fontsource/ibm-plex-mono/600.css";
import "@fontsource/ibm-plex-mono/600-italic.css";
import "@fontsource/ibm-plex-mono/700.css";
import "@fontsource/ibm-plex-mono/700-italic.css";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="icon"
      href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ’»</text></svg>"
    />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <meta name="description" content={siteConfig.description} />
    <title>{siteConfig.name} - {siteConfig.title}</title>

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://ratul0.github.io/" />
    <meta
      property="og:title"
      content={`${siteConfig.name} - ${siteConfig.title}`}
    />
    <meta property="og:description" content={siteConfig.description} />
    <meta property="og:image" content="https://ratul0.github.io/og-image.png" />
    <meta property="og:image:width" content="1200" />
    <meta property="og:image:height" content="630" />

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:url" content="https://ratul0.github.io/" />
    <meta
      name="twitter:title"
      content={`${siteConfig.name} - ${siteConfig.title}`}
    />
    <meta name="twitter:description" content={siteConfig.description} />
    <meta
      name="twitter:image"
      content="https://ratul0.github.io/og-image.png"
    />
  </head>
  <body class="antialiased">
    <!-- Film grain overlay (global) -->
    <div class="film-grain"></div>

    <Header />

    <main>
      <Hero />
      <About />
      <Projects />
      <Experience />
      <Education />
    </main>

    <Footer />

    <!-- Theme toggle button -->
    <button
      id="theme-toggle"
      class="theme-toggle"
      aria-label="Toggle dark mode"
    >
      <svg
        class="sun-icon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <circle cx="12" cy="12" r="5"></circle>
        <line x1="12" y1="1" x2="12" y2="3"></line>
        <line x1="12" y1="21" x2="12" y2="23"></line>
        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
        <line x1="1" y1="12" x2="3" y2="12"></line>
        <line x1="21" y1="12" x2="23" y2="12"></line>
        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
      </svg>
      <svg
        class="moon-icon"
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
      >
        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
      </svg>
    </button>
  </body>
</html>

<style>
  /* Add smooth scroll behavior */
  html {
    scroll-behavior: smooth;
  }
</style>

<script>
  // Theme toggle functionality with localStorage persistence
  const themeToggle = document.getElementById("theme-toggle");
  const body = document.body;

  // Check for saved theme preference or default to dark mode
  const savedTheme = localStorage.getItem("theme");

  // Apply theme on load - default to dark mode unless user explicitly chose light
  if (savedTheme !== "light") {
    body.classList.add("dark");
  }

  // Toggle theme on button click
  themeToggle?.addEventListener("click", () => {
    body.classList.toggle("dark");
    const isDark = body.classList.contains("dark");
    localStorage.setItem("theme", isDark ? "dark" : "light");

    // Update nav colors when theme changes
    const navPill = document.getElementById("nav-pill");
    const scrollY = window.scrollY;

    if (navPill) {
      const bgOpacity = scrollY > 50 ? 0.85 : 0.6;
      if (isDark) {
        navPill.style.background = `rgba(13, 17, 23, ${bgOpacity})`;
        navPill.style.borderColor = "var(--color-dark-border)";
      } else {
        navPill.style.background = `rgba(248, 246, 243, ${bgOpacity})`;
        navPill.style.borderColor = "var(--color-warm-border)";
      }
    }
  });

  // Intersection Observer for scroll reveal animations
  const observerOptions = {
    root: null,
    rootMargin: "0px",
    threshold: 0.1,
  };

  const observer = new IntersectionObserver((entries) => {
    entries.forEach((entry) => {
      if (entry.isIntersecting) {
        entry.target.classList.add("reveal");
        observer.unobserve(entry.target);
      }
    });
  }, observerOptions);

  // Observe all sections for animation
  document.addEventListener("astro:page-load", () => {
    const sections = document.querySelectorAll("section");
    sections.forEach((section) => {
      observer.observe(section);
    });
  });

  // Also observe on initial load
  const sections = document.querySelectorAll("section");
  sections.forEach((section, index) => {
    // Add staggered delays based on section index
    section.style.setProperty("--reveal-delay", `${index * 0.1}s`);
  });
</script>
